---
import db from '@/db'
import CMSLayout from '@/layouts/CMSLayout.astro'
import EnLaMano from '@/components/admin/EnLaMano'

const socialMedia = db.get<SocialMedia>('social-media')
const video = db.get<string>('video', false)!

if (Astro.request.method === 'POST') {
  const formData = await Astro.request.formData()
  const facebook = formData.get('facebook') || undefined
  const instagram = formData.get('instagram') || undefined

  await Promise.all([
    db.setImage(formData.get('logo') as File, 'logo.webp'),
    db.setImage(formData.get('logo-light') as File, 'logo-light.webp')
  ])

  db.set('social-media', JSON.stringify({ facebook, instagram }))
  db.set('video', formData.get('video') as string)

  return Astro.redirect('/admin')
}
---

<CMSLayout>
  <EnLaMano socialMedia={socialMedia} video={video} client:load />
</CMSLayout>
