---
import db from '@/db'
import CMSLayout from '@/layouts/CMSLayout.astro'
import EnLaMano from '@/components/admin/EnLaMano'

const socialMedia = db.get<SocialMedia>('social-media')

if (Astro.request.method === 'POST') {
  const formData = await Astro.request.formData()
  const facebook = formData.get('facebook') || undefined
  const instagram = formData.get('instagram') || undefined

  db.set('social-media', JSON.stringify({ facebook, instagram }))

  await Promise.all([
    db.setImage(formData.get('logo') as File, 'logo.webp'),
    db.setImage(formData.get('logo-light') as File, 'logo-light.webp')
  ])

  return Astro.redirect('/admin')
}
---

<CMSLayout>
  <EnLaMano socialMedia={socialMedia} client:load />
</CMSLayout>
